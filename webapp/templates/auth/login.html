{% extends "base.html" %}

{% block title %}Login - WriteBot{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}" />
{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-header">
        <div class="login-header__logo">‚úçÔ∏è</div>
        <h1>WriteBot</h1>
        <p>Sign in to your account</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('auth.login') }}" id="loginForm">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text"
                   id="username"
                   name="username"
                   required
                   autofocus
                   autocomplete="username"
                   placeholder="Enter your username">
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <div class="password-wrapper">
                <input type="password"
                       id="password"
                       name="password"
                       required
                       autocomplete="current-password"
                       placeholder="Enter your password">
                <button type="button"
                        class="password-toggle"
                        onclick="togglePassword()"
                        aria-label="Toggle password visibility"
                        title="Show/hide password">
                    üëÅÔ∏è
                </button>
            </div>
        </div>

        <div class="form-check">
            <input type="checkbox" id="remember" name="remember">
            <label for="remember">Remember me for 30 days</label>
        </div>

        <button type="submit" class="btn-login" id="loginBtn">Sign In</button>
    </form>

    <div class="security-badge">
        Your connection is secure and encrypted
    </div>

    {% if config.get('ALLOW_REGISTRATION') %}
    <div class="login-footer">
        <p>Don't have an account? <a href="{{ url_for('auth.register') }}">Register here</a></p>
    </div>
    {% endif %}
</div>

<script>
    // Toggle password visibility
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleBtn = document.querySelector('.password-toggle');

        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleBtn.textContent = 'üôà';
            toggleBtn.setAttribute('aria-label', 'Hide password');
        } else {
            passwordInput.type = 'password';
            toggleBtn.textContent = 'üëÅÔ∏è';
            toggleBtn.setAttribute('aria-label', 'Show password');
        }
    }

    // Add loading state to button on submit
    document.getElementById('loginForm').addEventListener('submit', function() {
        const btn = document.getElementById('loginBtn');
        btn.classList.add('loading');
        btn.disabled = true;
    });

    // Auto-dismiss success alerts after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const successAlerts = document.querySelectorAll('.alert-success');
        successAlerts.forEach(alert => {
            setTimeout(() => {
                alert.style.transition = 'opacity 0.5s ease';
                alert.style.opacity = '0';
                setTimeout(() => {
                    alert.remove();
                }, 500);
            }, 5000);
        });
    });

    // Focus management for better UX
    document.addEventListener('DOMContentLoaded', function() {
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        // If username is filled, focus on password
        if (usernameInput.value.trim() !== '') {
            passwordInput.focus();
        }
    });
</script>
{% endblock %}
