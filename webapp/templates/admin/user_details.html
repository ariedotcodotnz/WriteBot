{% extends "admin/base.html" %}

{% set active_nav = 'users' %}

{% block title %}User Details - {{ user.username }} - Admin - WriteBot{% endblock %}

{% block admin_title %}User Details: {{ user.username }}{% endblock %}

{% block admin_header_actions %}
<a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="btn btn-primary">Edit User</a>
<a href="{{ url_for('admin.users') }}" class="btn btn-secondary">Back to Users</a>
{% endblock %}

{% block admin_content %}
{# User Information #}
<div class="admin-section">
    <div class="admin-section__header">
        <h2 class="admin-section__title">User Information</h2>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Username</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">{{ user.username }}</div>
        </div>
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Full Name</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">{{ user.full_name or '-' }}</div>
        </div>
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Role</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">
                <span class="badge badge-{{ user.role }}">{{ user.role|capitalize }}</span>
            </div>
        </div>
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Status</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">
                {% if user.is_active %}
                <span class="badge badge-active">Active</span>
                {% else %}
                <span class="badge badge-inactive">Inactive</span>
                {% endif %}
            </div>
        </div>
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Created At</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
        <div style="padding: 16px; background-color: #f4f4f4; border-radius: 4px;">
            <div style="font-size: 12px; color: #6f6f6f; text-transform: uppercase; margin-bottom: 4px;">Last Login</div>
            <div style="font-size: 16px; color: #161616; font-weight: 500;">{{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}</div>
        </div>
    </div>
</div>

{# Usage Statistics #}
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-card__label">Total SVG Generations</div>
        <div class="stat-card__value">{{ total_svg }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__label">Total Batch Generations</div>
        <div class="stat-card__value">{{ total_batch }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__label">Total Lines</div>
        <div class="stat-card__value">{{ total_lines }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__label">Total Characters</div>
        <div class="stat-card__value">{{ total_chars }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__label">Processing Time</div>
        <div class="stat-card__value">{{ "%.1f"|format(total_time) }}s</div>
    </div>
</div>

{# Recent Activity #}
<div class="admin-section">
    <div class="admin-section__header">
        <div>
            <h2 class="admin-section__title">Recent Activity</h2>
            <p class="admin-section__subtitle">Last 100 activities for this user</p>
        </div>
    </div>

    {% if activities %}
    <table class="admin-table">
        <thead>
            <tr>
                <th>Activity Type</th>
                <th>Description</th>
                <th>IP Address</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in activities %}
            <tr>
                <td><span class="badge badge-{{ activity.activity_type }}">{{ activity.activity_type }}</span></td>
                <td>{{ activity.description or '-' }}</td>
                <td><code style="font-size: 12px; color: #6f6f6f;">{{ activity.ip_address or '-' }}</code></td>
                <td>{{ activity.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state__message">No activity recorded.</div>
    </div>
    {% endif %}
</div>
{% endblock %}
